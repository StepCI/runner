version: '1.1'
name: JSONata test
tests:
  example:
    steps:
      - name: JSONata evaluation test
        http:
          url: https://httpbin.org/ip
          method: GET
          captures:
            ip:
              jsonata: origin
          check:
            jsonata:
              formatcheck: |
                $match(origin, /(\d{1,3}\.){3}\d{1,3}/)
              # rewrite the above JSONata expression using the property name
              $.origin: $match($, /(\d{1,3}\.){3}\d{1,3}/)
      - name: JSONata return object sample
        http:
          url: https://jsonplaceholder.typicode.com/posts/
          method: GET
          check:
            jsonata:
              notmatch: |
                (
                  $a := 99;
                  $b := $count($);
                  { "expected": $a, "given": $b, "passed": ($a = $b) }
              $count($[userId=1]): 10
